<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FNS 905 Summer Site-Finder Report</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* Global Fix: Ensures padding doesn't add to the width of elements */
        * {
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --sidebar-bg: #0f172a;
            --main-bg: #f8fafc;
            --card-bg: #ffffff;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --code-bg: #1e1e1e;
            --border-color: #e2e8f0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--main-bg);
            color: var(--text-dark);
            margin: 0;
            display: flex;
            scroll-behavior: smooth;
            /* Prevents the entire page from scrolling sideways */
            overflow-x: hidden;
            width: 100%;
        }

        /* --- Sidebar Navigation --- */
        nav {
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            color: white;
            position: sticky;
            top: 0;
            padding: 2.5rem 1.5rem;
            overflow-y: auto;
            flex-shrink: 0; /* Prevents sidebar from squishing */
            border-right: 1px solid #334155;
        }

        nav h2 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.15rem;
            color: #94a3b8 !important;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #334155;
            padding-bottom: 10px;
        }

        nav a {
            display: block;
            color: #cbd5e1 !important;
            text-decoration: none !important;
            padding: 0.7rem 0.8rem;
            border-radius: 0.4rem;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            line-height: 1.4;
        }

        nav a:hover {
            background: #1e293b;
            color: white !important;
            transform: translateX(4px);
        }

        /* --- Main Content Area --- */
        main {
            flex: 1;
            padding: 3rem 4rem;
            max-width: calc(100% - 280px); /* Ensures main area respects sidebar width */
            min-width: 0; /* Crucial fix: allows flex items to shrink and prevents overflow */
            margin: 0 auto;
        }

        /* Header Styling */
        #header {
            text-align: center;
            margin-bottom: 3.5rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
        }

        h1.title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #222222 !important;
            margin-bottom: 0.5rem;
            font-family: 'Inter', sans-serif;
        }

        h4.author, h4.date {
            font-family: 'Inter', sans-serif;
            color: var(--text-light);
            font-weight: 400;
            margin: 5px 0;
        }

        /* --- Card Styling for Sections --- */
        div.section.level1 {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            width: 100%; /* Keep cards contained */
        }

        main h1 { 
            font-size: 1.8rem; 
            color: #222222 !important; 
            border-bottom: 2px solid var(--main-bg);
            padding-bottom: 1rem;
            margin-top: 0;
            font-family: 'Inter', sans-serif;
        }

        main h2 {
            font-size: 1.4rem;
            color: #333333 !important;
            margin-top: 2rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
        }

        p {
            margin-bottom: 1.5rem;
            line-height: 1.7;
            color: var(--text-dark);
            word-wrap: break-word; /* Prevents long text from breaking layout */
        }

        /* --- Code Block Styling --- */
        div.sourceCode {
            margin: 1.5rem 0;
            background-color: var(--code-bg);
            border-radius: 8px;
            border: 1px solid #334155;
            overflow-x: auto; /* Adds internal scrollbar for long R code lines */
            max-width: 100%; 
        }

        pre.sourceCode {
            margin: 0;
            padding: 1.5rem;
            background-color: transparent !important;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #d4d4d4;
        }

        /* Pandoc Syntax Highlighting */
        code span.co { color: #6a9955; font-style: italic; }
        code span.kw { color: #569cd6; font-weight: bold; }
        code span.dt { color: #569cd6; }
        code span.dv { color: #b5cea8; }
        code span.bn { color: #b5cea8; }
        code span.fl { color: #b5cea8; }
        code span.ch { color: #ce9178; }
        code span.st { color: #ce9178; }
        code span.fu { color: #dcdcaa; }
        code span.cn { color: #9cdcfe; }
        code span.at { color: #9cdcfe; }
        code span.va { color: #9cdcfe; }
        code span.cf { color: #c586c0; font-weight: bold; }
        code span.op { color: #d4d4d4; }
        code span.ot { color: #d4d4d4; }
        code span.pp { color: #c586c0; }

        /* Responsive Settings */
        @media (max-width: 1100px) {
            nav { display: none; }
            main { 
                padding: 2rem; 
                max-width: 100%;
            }
        }
    </style>
</head>

<body>

<nav>
    <h2>Table of Contents</h2>
    <a href="#set-up">1. Set Up</a>
    <a href="#data-import-and-prep">2. Data Import and Prep</a>
    <a href="#filter-inactive-sites-by-date">3. Filter Inactive Sites</a>
    <a href="#edit-checks">4. Edit Checks</a>
    <a href="#added-removed">5. Added & Removed</a>
    <a href="#prepare-to-save">6. Prepare to Save</a>
    <a href="#generate-report">7. Generate Report</a>
    <a href="#operational-changes">8. Operational Changes</a>
</nav>

<main>
    <div id="header">
        <h1 class="title">FNS 905 Summer Site-Finder Report</h1>
        <h4 class="author">Child Nutrition Programs | Jared Walker</h4>
    </div>

    <div id="set-up" class="section level1">
        <h1>1 - Set Up</h1>
        <div class="sourceCode" id="cb1">
<pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(list = ls(all.names = T)) #clear all objects from environment.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">max.print=</span><span class="dv">100</span>) <span class="co"># Limit output.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>start.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()   <span class="co"># Log start time. </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>) <span class="co"># Prohibit use of scientific notation</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gc</span>() <span class="co"># Free up memory and report the memory usage.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>curr_date <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y%m%d&quot;</span>)) <span class="co"># Format date as numeric</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># date &lt;- as.Date(date) # Use this code if date format is to be kept</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code></pre>
        </div>
    </div>

    <div id="data-import-and-prep" class="section level1">
    <h1>2 - Data Import and Prep</h1>
    <div id="merge-latitude-longitude" class="section level2">
    <h2>2.1 - Merge Latitude &amp; Longitude</h2>
    <div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Previous submission, clean names, remove extraneous columns</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>list <span class="ot">&lt;-</span> <span class="fu">file.info</span>(<span class="fu">list.files</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;P:/1_Internal/Reports/Summer/USDA 543a_FNS 905/2022_post COVID waivers&quot;</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">full.names =</span> T))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(list)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="fu">rownames</span>(list)[<span class="fu">which.max</span>(list<span class="sc">$</span>ctime)]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>previous_submission <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(filename) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  clean_names <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(so_o<span class="sc">:</span>map_y)) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">submission =</span> <span class="st">&quot;previous&quot;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Import both sheets of the Geocode Master List, clean names, rename long and lat to match FNS-905 Template, remove columns.</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>sso <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;P:/1_Internal/Reports/Summer/USDA 543a_FNS 905/Geocode Master List_CURRENT.xlsx&quot;</span>, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  clean_names <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">soo_x =</span> latitude, <span class="at">soo_y =</span> longitude, </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_site_id_number =</span> site_number) <span class="sc">%&gt;%</span> <span class="co"># Rename unique ID in order to merge()</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_site_id_number, soo_x, soo_y)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>sfsp <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;P:/1_Internal/Reports/Summer/USDA 543a_FNS 905/Geocode Master List_CURRENT.xlsx&quot;</span>, </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  clean_names <span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">soo_x =</span> latitude, <span class="at">soo_y =</span> longitude,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">state_site_id_number =</span> site_number) <span class="sc">%&gt;%</span> <span class="co"># Rename unique ID in order to merge()</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_site_id_number, soo_x, soo_y)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Import Data1026 &amp; Data1027, latin encoding, clean names, merge long and lat coordinates</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>data1026_sfsp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;H:/Downloads/Data1026 (71).csv&quot;</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">&quot;Latin1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  clean_names <span class="sc">%&gt;%</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_name<span class="sc">:</span>state_sponsor_id_number, last_modified_date) <span class="sc">%&gt;%</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(sfsp, <span class="at">by =</span> <span class="st">&quot;state_site_id_number&quot;</span>, <span class="at">all.x =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(state_site_id_number, <span class="at">.before =</span> state_sponsor_id_number)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>data1027_sso <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;H:/Downloads/Data1027 - 2022-07-26T040945.637.csv&quot;</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">&quot;Latin1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  clean_names <span class="sc">%&gt;%</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_name<span class="sc">:</span>state_sponsor_id_number, last_modified_date) <span class="sc">%&gt;%</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(sso, <span class="at">by =</span> <span class="st">&quot;state_site_id_number&quot;</span>, <span class="at">all.x =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(state_site_id_number, <span class="at">.before =</span> state_sponsor_id_number)</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: When transitioning between school years, it may be necessary download </span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co"># both the new SY &amp; the previous SY of Data1027 &amp; Data1026. If the previous SY </span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co"># has sites with end dates that are in the future, check to see if those sites </span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co"># are in the current year&#39;s data. If not, both schools years should be imported. </span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co"># After importing both years, combine the using this code:</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co"># data1026 &lt;- rbind(data1026 (1), data1026 (2))</span></span><span class="co"></span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co"># data1027 &lt;- rbind(data1027 (1), data1027 (2))</span></span></code></pre></div>
    </div>
    <div id="combine-1026-1027" class="section level2">
    <h2>2.2 - Combine 1026 &amp; 1027</h2>
    <div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine Data1026 &amp; Data1027</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data1027_sso, data1026_sfsp)</span></code></pre></div>
    </div>
    <div id="address-corrections" class="section level2">
    <h2>2.3 - Address Corrections</h2>
    <div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>address_correct <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">which</span>(all<span class="sc">$</span>state_site_id_number <span class="sc">==</span> x)       <span class="co"></span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="st">&quot;site_name&quot;</span>                                <span class="co"></span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> y                                          <span class="co"></span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(all[a, b])                                <span class="co"></span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Old =&quot;</span>, all[a, c]))                <span class="co"></span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;New =&quot;</span>, z))                        <span class="co"></span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  all[a, c] <span class="ot">&lt;-</span> z                                  <span class="co"> </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Confirm change:&quot;</span>, all[a, c] <span class="sc">==</span> z)) <span class="co"></span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="st">&quot;all&quot;</span>, all, <span class="at">envir =</span> <span class="fu">globalenv</span>())         <span class="co"></span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;&quot;</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;24-304&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;54 E 100 S&quot;</span>)            <span class="co"># RICH JR HIGH/NRES</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;21-704&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;53 S 100 E&quot;</span>)            <span class="co"># NORTH SUMMIT HIGH</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;21-110&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;240 S BEACON DR&quot;</span>)       <span class="co"># NORTH SUMMIT ELEMENTARY</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;21-304&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;76 S 100 E&quot;</span>)            <span class="co"># NORTH SUMMIT MIDDLE</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;30-740&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;211 South Tooele Blvd&quot;</span>) <span class="co"># BLUE PEAK HIGH</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;Q8-1&quot;</span>,   <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;24 Highway 98&quot;</span>)         <span class="co"># NAA TSIS&#39; AAN COMMUNITY SCHOOL</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;Q8-1&quot;</span>,   <span class="st">&quot;site_city&quot;</span>,     <span class="st">&quot;Tonalea&quot;</span>)               <span class="co"># NAA TSIS&#39; AAN COMMUNITY SCHOOL</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;Q8-1&quot;</span>,   <span class="st">&quot;site_zip&quot;</span>,      <span class="dv">86044</span>)                   <span class="co"># NAA TSIS&#39; AAN COMMUNITY SCHOOL</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;03-140&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;76785 W 11900 N&quot;</span>)       <span class="co"># GROUSE CREEK SCHOOL</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;02-104&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;510 North 650 East&quot;</span>)    <span class="co"># BELKNAP ELEMENTARY</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;02-704&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;195 E CENTER&quot;</span>)          <span class="co"># BEAVER HIGH</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;05-154&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;250 W 200 N&quot;</span>)           <span class="co"># WELLINGTON ELEMENTARY</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">address_correct</span>(<span class="st">&quot;25-108&quot;</span>, <span class="st">&quot;site_address1&quot;</span>, <span class="st">&quot;Old Main Highway 191&quot;</span>)  <span class="co"># BLUFF ELEMENTARY</span></span></code></pre></div>
    </div>
    <div id="format-dates" class="section level2">
    <h2>2.4 - Format Dates</h2>
    <div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format Dates</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> all <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">end_date_mm_dd_yy   =</span> <span class="fu">mdy</span>(end_date_mm_dd_yy),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">start_date_mm_dd_yy =</span> <span class="fu">mdy</span>(start_date_mm_dd_yy),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">last_modified_date  =</span> <span class="fu">mdy</span>(last_modified_date))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Dates with Base R</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#all &lt;- all %&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(end_date_mm_dd_yy   = as.Date(format(end_date_mm_dd_yy), &quot;%m/%d/%Y&quot;),</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         start_date_mm_dd_yy = as.Date(format(start_date_mm_dd_yy), &quot;%m/%d/%Y&quot;),</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#         last_modified_date  = as.Date(format(last_modified_date), &quot;%m/%d/%Y&quot;))</span></span></code></pre></div>
    </div>
    </div>

    <div id="filter-inactive-sites-by-date" class="section level1">
    <h1>3 - Filter Inactive Sites by Date</h1>
    <div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>active <span class="ot">&lt;-</span> all <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(end_date_mm_dd_yy <span class="sc">&gt;=</span> <span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(start_date_mm_dd_yy <span class="sc">&lt;=</span> <span class="fu">Sys.Date</span>() <span class="sc">+</span> <span class="dv">30</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(all)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(active)</span></code></pre></div>
    </div>

    <div id="edit-checks" class="section level1">
    <h1>4 - Edit Checks</h1>
    <div id="duplicate-site-numbers" class="section level2">
    <h2>4.1 - Duplicate Site Numbers</h2>
    <div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>duplicate_check <span class="ot">&lt;-</span> active <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a  =</span> <span class="fu">duplicated</span>(state_site_id_number, <span class="at">fromLast =</span> T),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">b  =</span> <span class="fu">duplicated</span>(state_site_id_number, <span class="at">fromLast =</span> F),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">ab =</span> <span class="fu">paste</span>(a, b))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> duplicate_check <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ab <span class="sc">!=</span> <span class="st">&quot;FALSE FALSE&quot;</span>) </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>active <span class="ot">&lt;-</span> duplicate_check <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ab <span class="sc">==</span> <span class="st">&quot;FALSE FALSE&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(a, b, ab))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>active.r <span class="ot">&lt;-</span> active</span></code></pre></div>
    </div>
    <div id="missing-latitude-longitude" class="section level2">
    <h2>4.2 - Missing Latitude &amp; Longitude</h2>
    <p>Write to a workbook list of sites with missing long and lat coordinates, get coordinates from Google, add to Geocode Master List_CURRENT.</p>
    <div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If NAs are present, save to file to add to Geocode Master List</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>NAs_1 <span class="ot">&lt;-</span> active <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_program, sponsoring_organization, state_sponsor_id_number,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>         site_name, state_site_id_number,   site_address1,  site_city,  </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         site_state,    site_zip, soo_x, soo_y) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(soo_x) <span class="sc">|</span> <span class="fu">is.na</span>(soo_y))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(NAs_1, <span class="st">&quot;H:/Documents/NAs_1.xlsx&quot;</span>, <span class="at">overwrite=</span>T)</span></code></pre></div>
    </div>
    <div id="other-missing-values" class="section level2">
    <h2>4.3 - Other Missing Values</h2>
    <p>Saves list of sites to workbook with NAs in other required fields.</p>
    <div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify NAs in the following columns</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>NAs_2 <span class="ot">&lt;-</span> active <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(site_address1) <span class="sc">|</span> <span class="fu">is.na</span>(site_zip) <span class="sc">|</span> <span class="fu">is.na</span>(site_city)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">|</span> <span class="fu">is.na</span>(site_state) <span class="sc">|</span> <span class="fu">is.na</span>(sponsoring_organization) </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>         <span class="sc">|</span> <span class="fu">is.na</span>(state_site_id_number) <span class="sc">|</span> <span class="fu">is.na</span>(state_sponsor_id_number))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.xlsx</span>(NAs_2, <span class="st">&quot;H:/Documents/NAs_2.xlsx&quot;</span>, <span class="at">overwrite=</span>T)</span></code></pre></div>
    </div>
    </div>

    <div id="added-removed" class="section level1">
    <h1>5 - Added &amp; Removed</h1>
    <p>Combine current and previous submissions and look for unique site numbers. Sites added are indicated by unique site numbers in the current submission, sites removed are indicated by unique site numbers in the previous submission. Filter unique site #â€™s by submission and save as separate data objects.</p>
    <div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>current_submission <span class="ot">&lt;-</span> active <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>last_modified_date) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">submission =</span> <span class="st">&quot;current&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>added_removed <span class="ot">&lt;-</span> <span class="fu">rbind</span>(previous_submission,current_submission)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify unique values</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>unique <span class="ot">&lt;-</span> added_removed <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a  =</span> <span class="fu">duplicated</span>(state_site_id_number, <span class="at">fromLast =</span> T),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">b  =</span> <span class="fu">duplicated</span>(state_site_id_number, <span class="at">fromLast =</span> F),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ab =</span> <span class="fu">paste</span>(a, b)) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ab <span class="sc">==</span> <span class="st">&quot;FALSE FALSE&quot;</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>added <span class="ot">&lt;-</span> unique <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_program, sponsoring_organization, site_name, </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>         start_date_mm_dd_yy, end_date_mm_dd_yy, submission) <span class="sc">%&gt;%</span> </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(submission <span class="sc">==</span> <span class="st">&quot;current&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>submission)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>removed <span class="ot">&lt;-</span> unique <span class="sc">%&gt;%</span> </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_program, sponsoring_organization, site_name, </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>         start_date_mm_dd_yy, end_date_mm_dd_yy, submission)  <span class="sc">%&gt;%</span> </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(submission <span class="sc">==</span> <span class="st">&quot;previous&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>submission)</span></code></pre></div>
    
    <div id="edit-check" class="section level2">
    <h2>5.1 - Edit Check</h2>
    <table style="width:83%;">
    <colgroup>
    <col width="5%" />
    <col width="5%" />
    <col width="6%" />
    <col width="65%" />
    </colgroup>
    <tbody>
    <tr class="odd">
    <td></td>
    <td></td>
    <td><br />
    +<br />
    -</td>
    <td><em>the # of sites in the previous submission<br />
    the # of sites added<br />
    the # of sites removed</em></td>
    </tr>
    <tr class="even">
    <td></td>
    <td></td>
    <td>=</td>
    <td><em>the # of sites in the current submission</em></td>
    </tr>
    </tbody>
    </table>
    <div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure the number of sites corresponds with the number of sites added and removed</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="fu">c</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">&quot; &quot;</span>, <span class="fu">nrow</span>(previous_submission), <span class="st">&quot;Previous&quot;</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">&quot;+&quot;</span>, <span class="fu">nrow</span>(added), <span class="st">&quot;Added&quot;</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">&quot;-&quot;</span>, <span class="fu">nrow</span>(removed), <span class="st">&quot;Removed&quot;</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">&quot;=&quot;</span>, (<span class="fu">nrow</span>(previous_submission) <span class="sc">+</span> <span class="fu">nrow</span>(added) <span class="sc">-</span> <span class="fu">nrow</span>(removed))),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">nrow</span>(current_submission), <span class="st">&quot;Current&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>()</span></code></pre></div>
    </div>
    </div>

    <div id="prepare-to-save" class="section level1">
    <h1>6 - Prepare to Save</h1>
    <p>Add spaces to site numbers to prevent data from being converted to dates in Excel. Reformat column headers for viewing.</p>
    <div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add spaces to site numbers to prevent them from turning into dates</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> all <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_site_id_number =</span> <span class="fu">paste0</span>(<span class="st">&quot; &quot;</span>, state_site_id_number, <span class="st">&quot; &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>last_modified_date)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>active <span class="ot">&lt;-</span> active <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_site_id_number =</span> <span class="fu">paste0</span>(<span class="st">&quot; &quot;</span>, state_site_id_number, <span class="st">&quot; &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>last_modified_date)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Column Names for Added / Removed Sheets</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(added) <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(<span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>,<span class="fu">colnames</span>(added)))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(removed) <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(<span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>,<span class="fu">colnames</span>(removed)))</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the number of rows of each data frame and save it as a vector.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>nrow_all<span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">nrow</span>(all))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>nrow_active<span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">nrow</span>(active))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>nrow_added<span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">nrow</span>(added))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>nrow_removed<span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">nrow</span>(removed))</span></code></pre></div>
    </div>

    <div id="generate-report" class="section level1">
    <h1>7 - Generate Report</h1>
    <div id="create-workbook" class="section level2">
    <h2>7.1 - Create Workbook</h2>
    <div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workbook</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> <span class="fu">createWorkbook</span>()</span></code></pre></div>
    </div>
    <div id="add-worksheets" class="section level2">
    <h2>7.2 - Add Worksheets</h2>
    <div id="active-sites" class="section level3">

    <div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Worksheets to Workbook and Name</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="fu">paste0</span>(<span class="st">&quot;Active Sites (&quot;</span>,nrow_active,<span class="st">&quot;)&quot;</span>))    </span><span class="co"># Active sites</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="fu">paste0</span>(<span class="st">&quot;All Sites (&quot;</span>,nrow_all,<span class="st">&quot;)&quot;</span>))          </span><span class="co"># All sites</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="fu">paste0</span>(<span class="st">&quot;Added (&quot;</span>,nrow_added,<span class="st">&quot;)&quot;</span>))            </span><span class="co"># Sites added</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">addWorksheet</span>(wb, <span class="fu">paste0</span>(<span class="st">&quot;Removed (&quot;</span>,nrow_removed,<span class="st">&quot;)&quot;</span>))        </span><span class="co"># Sites removed</span></span></div></span></code></pre>
    </div>
    </div>
    <div id="write-data" class="section level2">
    <h2>7.3 - Write Data</h2>
    <div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write Data to Worksheets</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(wb, <span class="at">sheet =</span> <span class="fu">paste0</span>(<span class="st">&quot;Active Sites (&quot;</span>,nrow_active,<span class="st">&quot;)&quot;</span>), <span class="at">x =</span> active)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(wb, <span class="at">sheet =</span> <span class="fu">paste0</span>(<span class="st">&quot;All Sites (&quot;</span>,nrow_all,<span class="st">&quot;)&quot;</span>), <span class="at">x =</span> all)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(wb, <span class="at">sheet =</span> <span class="fu">paste0</span>(<span class="st">&quot;Added (&quot;</span>,nrow_added,<span class="st">&quot;)&quot;</span>), <span class="at">x =</span> added)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(wb, <span class="at">sheet =</span> <span class="fu">paste0</span>(<span class="st">&quot;Removed (&quot;</span>,nrow_removed,<span class="st">&quot;)&quot;</span>), <span class="at">x =</span> removed)</span></code></pre></div>
    </div>
    <div id="save-sheets-to-workbook" class="section level2">
    <h2>7.4 - Save Sheets to Workbook</h2>
    <div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWorkbook</span>(wb, <span class="fu">paste0</span>(<span class="st">&quot;H:/Documents/USDA FNS 905 Submission &quot;</span>, curr_date, <span class="st">&quot;.xlsx&quot;</span>), <span class="at">overwrite =</span> T)</span></code></pre></div>
    </div>
    </div>

    <div id="operational-changes" class="section level1">
    <h1>8 - Operational Changes</h1>
    <div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>active <span class="ot">&lt;-</span> active.r</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset data</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>modifications <span class="ot">&lt;-</span> active <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(last_modified_date <span class="sc">&gt;=</span> <span class="fu">Sys.Date</span>()<span class="sc">-</span><span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_site_id_number =</span> <span class="fu">paste0</span>(<span class="st">&quot; &quot;</span>, state_site_id_number, <span class="st">&quot; &quot;</span>))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(modifications)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Save to P Drive</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(modifications, <span class="fu">paste0</span>(<span class="st">&quot;P:/1_Internal/Contracts, MOUs, State Agreements, Purchase Requests (non-conference)/DOH SFSP Health Inspections/2022/FNS 905 Operational Changes &quot;</span>, curr_date, <span class="st">&quot;.csv&quot;</span>),<span class="at">row.names=</span>F, <span class="at">na=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>end.time <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>() <span class="co"># Stop Timer        </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>duration <span class="ot">&lt;-</span> end.time <span class="sc">-</span> start.time</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>duration</span></code></pre></div>
    </div>
</main>

</body>
</html>